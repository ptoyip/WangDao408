# 操作系统的概念、功能
## 定义
操作系统（Operating System, OS）是指==控制和管理==整个计算机系统的==硬件和软件==资源，并合理地组织调度计算机的工作和资源的分配，以提供给用户和其他软件方便的接口和环境；它是计算机系统中最基本的系统软件。
- 操作系统是系统资源的管理者，同时管理了硬件和软件
- 操作系统需要向上层（软件，用户）提供易用的服务
- 操作系统是最接近硬件的一层软件

## 功能和目标
### 作为系统资源的管理者
需要提供
1. 处理机管理
2. 储存器管理
3. 文件管理
4. 设备管理
目标是让系统安全，高效的运行

### 给上层提供易用的服务
- 硬件层只能听懂二进制指令， 而操作系统利用了==封装思想==，把硬件功能封装成简单易用的服务，让用户能更方便的使用计算机，无需关心底层硬件的操作原理，只需要对操作系统发起命令即可
- 例子
	- [[GUI]]
	- 联机命令接口（交互式命令接口，例如window的time，python的idle）
	- 脱机命令接口（批处理命令接口，例如window的*.bat，python的.py）
	- 程序接口（可以在程序中进行系统调用来使用程序接口，普通用户只能透过代码间接使用）
		- 写程序的时候是代码调用了操作系统的程序接口（print调用了io）

### 对硬件机器拓展
- 操作系统需要对裸机（没有任何软件支持的计算机）拓展成功能性更好，更方便的机器。通常把覆盖了软件的机器称为虚拟机。
- 把CPU，内存，磁盘等硬件合理地组织起来，以实现更复杂的功能。

## 特征
### 并发
和共享互为最基本的特征，两者互为存在条件

**定义**：并发指的是两个或者多个事件在同一时间间隔内发生。这些事情==宏观上是同时发生==的，但是==微观上是交替发生==的。
**注意：** 并发和并行并不是同一个概念，并行指的是两个或者多个事件在同一时刻同时发生

操作系统的并发性指的是计算机系统中“同时”运行着多个程序。操作系统是伴随着“多道程序技术”而出现的，因此操作系统和程序并发是一起诞生的。
- 操作系统也是软件之一，所以要作为硬件和软件中间的桥梁的话，是必须实现并发这一特征的。

单核CPU同一时刻只能执行一个程序，各个程序只能并发地执行。
多核CPU同一时刻可以执行多个程序，多个程序可以并行的执行。对于运行程序多于CPU核来说，依旧是并发执行。

### 共享
和并发互为最基本的特征，两者互为存在条件

**定义**：共享指的是资源共享，系统中的资源可供内存中多个并发执行的进程共同使用。
1. 互斥共享方式指的是系统中的某些资源一个时间段内只允许一个进程访问该资源。
2. 同时共享方式指的是允许一个时间段内多个资源“同时”访问，但微观上仍是交替访问的。

--- 
**并发性**指的是计算机系统中同时存在多个运行中的程序
**共享性**指的是系统中资源可以同时供给内存中多个并发执行的进程共同使用
例子：
- QQ正在发送文件A，微信正在发送文件B
- 两个进程（QQ，微信）正在并发执行，如果失去了并发性，只能有一个程序在运行，那么共享性则失去了意义。
- 两个进程需要共享地访问硬盘资源，如果失去了共享性，只能有一个程序访问，那么并发性则失去了意义。

### 虚拟
**定义**： 指的是把一个物理上的实体变为若干个逻辑上的对应物。物理实体是实际存在的，而逻辑对应物是用户感受到的。

例子：
- 微信需要2G的运行内存，QQ也需要2G的运行内存，但是可以同时在一台只有2G的机器上运行，运用了“空分复用技术”
- 微信需要1个CPU运行，QQ也需要1个CPU运行，但是可以同时跑在单核CPU上，运用了“时分复用技术”

同样，如果没了并发/共享性，则虚拟性就没有意义了
### 异步
**定义**：指的是在多道程序环境下，允许多个程序并发执行，但由于资源有限，进程的执行并不是连贯的，而是允许进程断断续续进行，以不可预知的速度向前推进。

同样，没了并发/共享性，程序只能串行运行，那么异步性就没意义了。

## 发展和分类
### 手工操作阶段
程序员在纸带上打孔，然后放在纸带机上读取，在计算机中运算，然后纸带机输出，最后程序员读取
缺点：资源利用率低
![[Pasted image 20240904174826.png]]
### 批处理阶段
#### 单道批处理系统
引入脱机输入/输出技术（外围机+磁带），并由监督程序（操作系统雏形）负责控制作业的输入输出
优点：缓解了一定程度上的人机速度矛盾
缺点：内存中仅能一道程序运行，CPU有大量时间是空闲等待I/O完成
![[Pasted image 20240904174925.png]]
#### 多道批处理系统
优点：支持并发执行，共享计算机资源，资源利用率提升
缺点：没有人机交互功能，一旦程序运行中，无法调试/修改 
![[Pasted image 20240904175356.png]]
### 分时操作系统
计算机以时间片尾单位轮流为各个用户/作业服务
主要优点：用户请求可以被及时响应，解决了人机交互问题，允许多个用户同时使用一台计算机。
缺点：不能优先处理紧急任务。

### 实时操作系统
在实施操作系统的控制下，计算机系统接受到外部信号后及时进行处理，并且要在严格的时限内处理完事件。实时操作系统主要特点是即时性和可靠性。
- 硬实时系统：必须在严格的规定时间内完成处理
- 软实时系统：能接受偶尔违反时间规定

## 运行机制
### 指令（二进制机器指令）
操作系统内核作为“管理者”，有时候会让CPU执行“特权指令”，这些一般都只允许“管理者”，即操作系统内核来使用。
应用程序一般只能运行“非特权指令”。

### 处理机状态
内核态=核心态=管态：
当CPU处于内核态，说明此时正在运行内核程序，此时CPU允许执行特权指令。
用户态：
当CPU处于用户态，说明此时正在运行应用程序，此时CPU只能执行非特权指令。

CPU中有寄存器交“程序状态字寄存器（PSW）”，保存CPU处于哪一个状态。
1. 刚开机时，CPU为“内核态”，操作系统内核程序先上CPU运行。
2. 开机完成后，用户可以启动某个应用程序。
3. 操作系统内核程序在合适的时候主动让出CPU，让该应用程序上CPU运行
	1. 操作系统内核程序会在让出CPU之前，用一条特权指令把PSW设置成“用户态”
4. 应用程序运行在“用户态”
5. 如果应用程序中出现非法的特权指令，CPU会发现特权指令和“用户态”的冲突
6. 非法时间会触发中断信号，CPU检测到之后，会立刻变为“核心态”，并停止运行当前的应用程序，转而运行**处理中断核心信号**的内核程序。
7. “中断”会令到操作系统
### 程序
内核程序：负责实现操作系统，由很多内核程序组成了“操作系统内核”（kernel）。
内核是操作系统中最接近硬件的部分，不包括全部操作系统的功能，例如GUI

应用程序：普通程序员写的程序